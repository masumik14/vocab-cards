<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂçòË™ûÂ∏≥</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            background-color: #f0f4f8;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            color: #333;
            touch-action: manipulation;
            padding: 10px;
        }

        /* ÁÆ°ÁêÜÁî®„Ç®„É™„Ç¢ÔºàCSVË™≠„ÅøËæº„Åø„Å™„Å©Ôºâ */
        .admin-area {
            margin-bottom: 20px;
            padding: 10px 20px;
            background: #fff;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #666;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            text-align: center;
            width: 90%;
            max-width: 500px;
        }

        input[type="file"] {
            margin-top: 5px;
            max-width: 100%;
        }

        .card {
            background-color: white;
            width: 90%;
            max-width: 500px;
            height: 350px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            cursor: pointer;
            position: relative;
            transition: transform 0.1s;
            user-select: none;
        }

        .card:active {
            transform: scale(0.98);
        }

        .label-badge {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #ecf0f1;
            color: #7f8c8d;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .speaker-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2rem;
            color: #3498db;
            background: #eaf6ff;
            width: 50px;
            height: 50px;
            line-height: 50px;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.2s;
            z-index: 10;
        }

        .speaker-icon:hover {
            background: #d0e9ff;
        }

        .card-content {
            font-size: 2.8rem;
            font-weight: bold;
            margin-bottom: 20px;
            width: 100%;
            line-height: 1.2;
        }

        .card-content.jp-text {
            font-size: 2rem;
        }

        .card-sub {
            font-size: 1.6rem;
            color: #e74c3c;
            min-height: 1.5em;
            font-weight: bold;
            width: 100%;
        }

        .hint {
            font-size: 1rem;
            color: #95a5a6;
            position: absolute;
            bottom: 20px;
        }

        .controls {
            width: 90%;
            max-width: 500px;
            margin-top: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 15px 30px;
            font-size: 1.1rem;
            cursor: pointer;
            border: none;
            border-radius: 12px;
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }

        button:hover {
            background-color: #2980b9;
        }

        button.secondary {
            background-color: #95a5a6;
        }
    
        
        .top-controls {
            margin-bottom: 15px;
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 12px;
            align-items: center;
        }

        .rate-control {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            color: #666;
            background: #fff;
            padding: 10px 14px;
            border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            min-width: 0; /* allow shrink within grid */
        }

        .rate-control input[type="range"] {
            width: 180px;
            max-width: 100%;
        }

        /* Top buttons: consistent height */
        .top-controls button {
            height: 44px;
            padding: 0 22px;
            white-space: nowrap;
        }

        /* Small screens: stack neatly */
        @media (max-width: 420px) {
            .top-controls {
                grid-template-columns: 1fr 1fr;
            }
            .top-controls .rate-control {
                grid-column: 1 / -1;
            }
            .top-controls button {
                width: 100%;
            }
        }

    </style>
</head>

<body>

    <div class="admin-area">
        <label for="csvFile">üìÇ Âà•„ÅÆÂçòË™û„É™„Çπ„Éà(CSV)„ÇíË™≠„ÅøËæº„ÇÄ</label><br>
        <input type="file" id="csvFile" accept=".csv" onchange="loadCSV(this)">
    </div>

    
    <div class="controls top-controls">
        <label class="rate-control">
            Speed
            <input type="range" min="0.6" max="1.0" step="0.05" value="0.8" oninput="setSpeechRate(this.value)">
            <span id="rateValue">0.8</span>
        </label>
        <button class="secondary" onclick="shuffleCards()">„Ç∑„É£„ÉÉ„Éï„É´</button>
        <button class="secondary" onclick="toggleQuizMode()">Âá∫È°åÂèçËª¢</button>
    </div>

<div class="card" onclick="flipCard()">
        <div class="label-badge" id="typeLabel">ÂïèÈ°å</div>
        <div class="speaker-icon" onclick="playAudio(event)">üîä</div>
        <div class="card-content" id="question">Loading...</div>
        <div class="card-sub" id="answer"></div>
        <div class="hint">„Çø„ÉÉ„Éó„Åó„Å¶Á≠î„Åà„ÇíË¶ã„Çã</div>
    </div>

    <div class="controls">
        <button class="secondary" onclick="prevCard()">Êàª„Çã</button>
        <button onclick="nextCard()">Ê¨°„Å∏ (Next)</button>
    </div>

    <script>
        // ‚òÖ‚òÖ‚òÖ „Éá„Éï„Ç©„É´„Éà„Éá„Éº„ÇøÔºà„Éï„Ç°„Ç§„É´Ë™≠„ÅøËæº„Åø„Åå„Å™„ÅÑÂ†¥Âêà„Å´Ë°®Á§∫Ôºâ ‚òÖ‚òÖ‚òÖ
        const defaultData = [
            { en: "parent or parents", jp: "Ë¶™„ÄÅ[s„Å§„Åç„Åß]‰∏°Ë¶™", startMode: "jp" },
            { en: "relax or relaxed", jp: "„Åè„Å§„Çç„Åê", startMode: "en" },
            { en: "special", jp: "ÁâπÂà•„ÅÆ", startMode: "en" },
            { en: "traditional", jp: "‰ºùÁµ±ÁöÑ(„Åß„Çì„Å®„ÅÜ„Å¶„Åç)„Å™", startMode: "jp" },
            { en: "care", jp: "‰∏ñË©±", startMode: "jp" },
            { en: "fell", jp: "fallÔºàËª¢„Å∂Ôºâ„ÅÆÈÅéÂéªÂΩ¢(„Åã„Åì„Åë„ÅÑ)", startMode: "en" },
            { en: "grandma", jp: "„Åä„Å∞„ÅÇ„Å°„ÇÉ„Çì", startMode: "en" },
            { en: "hotel", jp: "„Éõ„ÉÜ„É´„ÄÅÊóÖÈ§®", startMode: "en" },
            { en: "miss", jp: "‚Ä¶„Åå„Å™„ÅÑ„ÅÆ„Çí„Åï„Å≥„Åó„ÅèÊÄù„ÅÜ", startMode: "jp" },
            { en: "outside", jp: "Â§ñ„Åß[„Å´„ÄÅ„Å∏]", startMode: "jp" },
            { en: "show or showing", jp: "‚Ä¶„ÇíË¶ã„Åõ„Çã„ÄÅÁ§∫„Åô(„Åó„ÇÅ„Åô)", startMode: "en" },
            { en: "against", jp: "‚Ä¶„Å´ÂØæÊäó(„Åü„ÅÑ„Åì„ÅÜ)„Åó„Å¶„ÄÅÂèçÂØæ„Åó„Å¶", startMode: "jp" },
            { en: "another", jp: "„Åª„Åã„ÅÆ„ÄÅÂà•„ÅÆ„ÄÅ„Å°„Åå„Å£„Åü", startMode: "jp" }
        ];

        let currentList = [...defaultData];
        let currentIndex = 0;
        let isShowingAnswer = false;

        
        
        // Ë™≠„Åø‰∏ä„ÅíÈÄüÂ∫¶Ôºà„Çπ„É©„Ç§„ÉÄ„Éº„ÅßÂ§âÊõ¥Ôºâ
        let speechRate = 0.8;
        function setSpeechRate(v) {
            speechRate = Number(v);
            const el = document.getElementById('rateValue');
            if (el) el.textContent = v;
        }
// Âá∫È°åÊñπÂêëÔºàauto=ÂçòË™û„Åî„Å®„ÅÆstartMode„ÄÅen2ja=Ëã±‚ÜíÊó•Âõ∫ÂÆö„ÄÅja2en=Êó•‚ÜíËã±Âõ∫ÂÆöÔºâ
        let quizMode = 'auto';
// --- CSVË™≠„ÅøËæº„ÅøÂá¶ÁêÜ ---
        function loadCSV(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const text = e.target.result;
                parseCSV(text);
            };
            reader.readAsText(file);
        }

        function parseCSV(text) {
            const newData = [];
            const lines = text.split(/\r\n|\n/);

            lines.forEach(line => {
                if (!line.trim()) return;
                const cols = line.split(',');
                if (cols.length >= 2) {
                    newData.push({
                        en: cols[0].trim(),
                        jp: cols[1].trim(),
                        startMode: (cols[2] && cols[2].trim() === 'en') ? 'en' : 'jp'
                    });
                }
            });

            if (newData.length > 0) {
                currentList = [...newData];
                currentIndex = 0;
                resetCard();
                // Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü„É°„ÉÉ„Çª„Éº„Ç∏
                alert(`CSV„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„ÅüÔºÅ\nÂÖ®${newData.length}ÂçòË™û„Å´Âàá„ÇäÊõø„Çè„Çä„Åæ„Åô„ÄÇ`);
                // ÂÖ•Âäõ„Çí„ÇØ„É™„Ç¢ÔºàÂêå„Åò„Éï„Ç°„Ç§„É´„ÇíÂÜçË™≠„ÅøËæº„Åø„Åß„Åç„Çã„Çà„ÅÜ„Å´Ôºâ
                document.getElementById('csvFile').value = "";
            } else {
                alert("„ÅÜ„Åæ„ÅèË™≠„ÅøËæº„ÇÅ„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇCSV„ÅÆ‰∏≠Ë∫´„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
            }
        }
        // -----------------------

        function updateDisplay() {
            if (currentList.length === 0) return;

            const item = currentList[currentIndex];
            const qEl = document.getElementById('question');
            const aEl = document.getElementById('answer');
            const labelEl = document.getElementById('typeLabel');

            let questionText = "";
            let answerText = "";
            let isJpQuestion = false;

            // Âá∫È°åÊñπÂêë„ÇíÊ±∫ÂÆöÔºàquizMode„Ååauto„ÅÆÂ†¥Âêà„ÅÆ„Åø„ÄÅÂçòË™û„Åî„Å®„ÅÆstartMode„Çí‰Ωø„ÅÜÔºâ
            let mode = quizMode;
            if (mode === 'auto') {
                mode = (item.startMode === 'jp') ? 'ja2en' : 'en2ja';
            }

            if (mode === 'ja2en') {
                questionText = item.jp;
                answerText = item.en;
                isJpQuestion = true;
                labelEl.textContent = "Êó•Êú¨Ë™û ‚Üí Ëã±Ë™û";
            } else {
                questionText = item.en;
                answerText = item.jp;
                isJpQuestion = false;
                labelEl.textContent = "Ëã±Ë™û ‚Üí Êó•Êú¨Ë™û";
            }

            qEl.textContent = questionText;
            if (isJpQuestion) {
                qEl.classList.add("jp-text");
            } else {
                qEl.classList.remove("jp-text");
            }
            aEl.textContent = isShowingAnswer ? answerText : "";
        }

        function flipCard() {
            isShowingAnswer = !isShowingAnswer;
            updateDisplay();
        }

        function nextCard() {
            isShowingAnswer = false;
            currentIndex++;
            if (currentIndex >= currentList.length) {
                currentIndex = 0;
            }
            updateDisplay();
        }

        function prevCard() {
            isShowingAnswer = false;
            currentIndex--;
            if (currentIndex < 0) {
                currentIndex = currentList.length - 1;
            }
            updateDisplay();
        }


        function shuffleCards() {
            for (let i = currentList.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [currentList[i], currentList[j]] = [currentList[j], currentList[i]];
            }
            currentIndex = 0;
            resetCard();
            alert("„Ç∑„É£„ÉÉ„Éï„É´„Åó„Åæ„Åó„ÅüÔºÅ");
        }

        function resetCard() {
            isShowingAnswer = false;
            updateDisplay();
        }

        
        function toggleQuizMode() {
            // auto ‚Üí (ÁèæÁä∂„Å´Âêà„Çè„Åõ„Å¶ÂèçËª¢) ‚Üí ‰ª•Âæå„ÅØÂõ∫ÂÆöÊñπÂêë„ÅßÂèçËª¢
            isShowingAnswer = false;

            if (quizMode === 'auto') {
                const item = currentList[currentIndex];
                const current = (item && item.startMode === 'jp') ? 'ja2en' : 'en2ja';
                quizMode = (current === 'ja2en') ? 'en2ja' : 'ja2en';
            } else {
                quizMode = (quizMode === 'ja2en') ? 'en2ja' : 'ja2en';
            }
            updateDisplay();
        }

let speechPrimed = false;

        function primeSpeechOnce() {
            // iPad/iPhoneÁ≠â„Åß„ÄåÊúÄÂàù„ÅÆ1Âõû„Å†„ÅëÁÑ°Èü≥„Äç„Å´„Å™„Çä„Åå„Å°„Å™ÊåôÂãï„ÇíÈÅø„Åë„Çã„Åü„ÇÅ„ÅÆÊúÄÂ∞èprime
            if (speechPrimed) return false;
            speechPrimed = true;

            try {
                // „Åæ„Åö„Ç≠„É•„Éº„Çí„ÇØ„É™„Ç¢„Åó„Å¶„Åã„Çâ„ÄÅÊ•µÁü≠„ÅÑÁô∫Ë©±„Çí1Âõû„Å†„ÅëÊµÅ„Åó„Å¶„Ç®„É≥„Ç∏„É≥„ÇíËµ∑Âãï„Åï„Åõ„Çã
                speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(' ');
                u.lang = 'en-US';
                u.rate = 0.9;
                speechSynthesis.speak(u);
            } catch (e) {
                // speechSynthesisÊú™ÂØæÂøú/Âà©Áî®‰∏çÂèØ„ÅÆÁí∞Â¢É„Åß„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            }
            return true;
        }

        function playAudio(event) {
            event.stopPropagation(); // „Ç´„Éº„Éâ„ÅåË£èËøî„Çã„ÅÆ„ÇíÈò≤„Åê

            if (currentList.length === 0) return;
            const item = currentList[currentIndex];
            const text = (item.en || "").trim();

            if (!text) return;

            // ‚òÖÊúÄÂ∞èprimeÔºàÊúÄÂàù„ÅÆ1Âõû„Å†„ÅëÔºâ
            const didPrime = primeSpeechOnce();

            // 2ÂõûÁõÆ‰ª•Èôç„ÅØ„ÄÅÈÄ£ÊâìÂØæÁ≠ñ„Å®„Åó„Å¶„Ç≠„É•„Éº„Çí„ÇØ„É™„Ç¢
            if (!didPrime) {
                speechSynthesis.cancel();
            }

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = speechRate; // ÈÄüÂ∫¶

            // iPad/iPhone„ÅßÊó•Êú¨Ë™ûÊ∑∑„Åò„Çä„Å´„Å™„Çâ„Å™„ÅÑ„Çà„ÅÜ„ÄÅÊòéÁ§∫ÁöÑ„Å´Ëã±Ë™û„ÅÆÂ£∞„ÇíÊé¢„ÅôÔºàÂøµ„ÅÆ„Åü„ÇÅÔºâ
            // ‚ÄªÁí∞Â¢É„Å´„Çà„ÇäÂàùÂõû„ÅØÁ©∫ÈÖçÂàó„ÅÆ„Åì„Å®„Åå„ÅÇ„Çã„Åü„ÇÅ„ÄÅË¶ã„Å§„Åã„Å£„ÅüÊôÇ„Å†„ÅëÈÅ©Áî®
            const voices = speechSynthesis.getVoices();
            const enVoice = voices.find(v => v.lang === 'en-US');
            if (enVoice) {
                utterance.voice = enVoice;
            }

            speechSynthesis.speak(utterance);
        }


        // ÂàùÊúüË°®Á§∫
        updateDisplay();
    </script>
</body>

</html>